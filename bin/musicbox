#!/usr/bin/env ruby

require 'simple-command'
require 'musicbox'

SimpleCommand.run do

  global root: nil do
    @musicbox = MusicBox.new(root: @root)
  end

  command 'export', dir: nil, compress: false, force: false, parallel: true do |args|
    @musicbox.export(args,
      dir: @dir,
      compress: @compress,
      force: @force,
      parallel: @parallel)
  end

  command 'diff-info' do |args|
    @musicbox.diff_info(args)
  end

  command 'fix' do |args|
    @musicbox.fix(args)
  end

  command 'extract-cover' do |args|
    @musicbox.extract_cover(args)
  end

  command 'cover', prompt: false do |args|
    @musicbox.cover(args,
      prompt: @prompt)
  end

  command 'import' do |args|
    @musicbox.import(args)
  end

  command 'label' do |args|
    @musicbox.label(args)
  end

  command 'dir' do |args|
    @musicbox.dir(args)
  end

  command 'open' do |args|
    @musicbox.open(args)
  end

  command 'select-cover', force: false do |args|
    @musicbox.select_cover(args, force: @force)
  end

  command 'orphaned' do
    @musicbox.orphaned
  end

  command 'show-albums', cover: false do |args|
    if @cover
      mode = :cover
    else
      mode = :summary
    end
    @musicbox.show_albums(args, mode: mode)
  end

  command 'show-releases', details: false do |args|
    if @details
      mode = :details
    else
      mode = :summary
    end
    @musicbox.show_releases(args, mode: mode)
  end

  command 'csv' do |args|
    @musicbox.csv(args)
  end

  command 'dups' do |args|
    @musicbox.dups(args)
  end

  command 'artist-keys' do
    @musicbox.artist_keys
  end

  command 'play', prompt: nil, device: nil, exclusive: nil, mpv_log_level: nil, eq: nil, ignore_state: nil do |args|
    @musicbox.play(args,
      prompt: @prompt,
      audio_device: @device,
      audio_exclusive: @exclusive,
      mpv_log_level: @mpv_log_level,
      equalizer_name: @eq,
      ignore_state: @ignore_state)
  end

  command 'select' do |args|
    @musicbox.select(args)
  end

  command 'update' do |args|
    @musicbox.update
  end

  command 'update-info' do |args|
    @musicbox.update_info(args)
  end

  command 'update-tags', force: false do |args|
    @musicbox.update_tags(args,
      force: @force)
  end

end